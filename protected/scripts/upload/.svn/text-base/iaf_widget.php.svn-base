<?php

// --------------------------------------------------------------------------
// Start-up
// ---------

session_start();

$classx_root=dirname(dirname(dirname(dirname(dirname(dirname(dirname(dirname(__FILE__))))))));

require_once("$classx_root/system/common/lib/lib_core.php");
require_once("$classx_root/system/common/lib/lib_access.php");

$classx_webroot=get_webroot($classx_root);

// --------------------------------------------------------------------------

$subject = sanitize_input($_GET["subject"]);
$session = sanitize_input($_GET["session"]);

// --------------------------------------------------------------------------
// Access Control
// ---------------
//gate_keeper($_SESSION,'publisher',$subject);
// Gate keeper dismissed here because it was blocking the callback from the destination server to the upload widget on upload completion.
// --------------------------------------------------------------------------

$url=str_replace($_SERVER['DOCUMENT_ROOT'],'http://'.$_SERVER['SERVER_NAME'],realpath('.'));
require_once 'in_a_flash/class.FlashUploader.php';
IAF_display_js();
$uploader = new FlashUploader('widgetDiv', 'in_a_flash/uploader',"$url/in_a_flash/upload.php");

$uploader->pass_var('subject', $subject);
$uploader->pass_var('session', $session);

$uploader->display();
?>
<html>
<body>
</body>
</html>
